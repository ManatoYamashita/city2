# Requirements Specification

## Overview
大学生向け授業口コミプラットフォーム「City2」- 履修登録時に先輩学生のリアルな授業レビューを参照できるWebアプリケーション。企業口コミサイト（OpenWork等）の大学授業版として設計し、Next.js 15 + Supabase + Stripe構成で実装。

## Project Description (User Input)
City2

1. WebAppの種類 大学生向けに、履修登録時の参考にしてもらうための授業ごとの口コミサイト 
2. 詳細 
    a. 機能: 授業の一覧、検索、概要、詳細、口コミ、評価、質問、課題の情報、難易度などについての情報の提供と登録、編集(就活で学生が参照する企業の口コミサイトのようなものをイメージしています。) 
    b. 目的: 履修登録前に授業のことについて、その授業を受けた先輩学生のリアルな声を知る
    c. ターゲット: 大学の履修登録にどの授業を受講するか迷っている大学生  

## その他 
### ユーザー認証について 
1. 一般的なメールアドレスで認証を行います。
2. 認証にsupabaseを使用
### 対象範囲について 
2. まずは1つの大学を対象からにして、将来的に対象を広げていきます。 
### データ管理 
3. 授業情報(科目名、教員名、単位数など)は手動で登録してもらう
* 過去問の機能は有料ユーザに提供したいので、Stripeでの決済も行いたい
* Next.js 15 AppRouterを使用します。srcディレクトリは不要です。
* tailwindCSS, ShadcnUIでUIを作成
* 初期は費用を抑えてスケールするにつれてコストをかける
use context7詳細に設計を行ってください。 ultrathink

## Requirements

### Requirement 1: ユーザー認証とアカウント管理
**User Story:** 大学生として、安全にプラットフォームにアクセスし、自分の口コミを管理したい

#### Acceptance Criteria
1. WHEN ユーザーがメールアドレスとパスワードで新規登録を行う THEN Supabaseを通じてアカウントが作成される
2. WHEN ユーザーがログインする THEN 認証情報が検証され、ダッシュボードにリダイレクトされる
3. WHEN ユーザーがプロフィール情報（学年、学部）を設定する THEN データが安全に保存される
4. IF 認証に失敗した場合 THEN 適切なエラーメッセージが表示される
5. WHEN ユーザーがパスワードリセットを要求する THEN Supabaseのパスワードリセット機能が実行される

### Requirement 2: 授業情報管理システム
**User Story:** 管理者として、授業の基本情報を登録・編集し、学生が検索できるようにしたい

#### Acceptance Criteria
1. WHEN 管理者が新しい授業を登録する THEN 科目名、教員名、単位数、学部、開講時期が保存される
2. WHEN 学生が授業一覧を閲覧する THEN ページネーションされた授業リストが表示される
3. WHEN 授業詳細ページにアクセスする THEN 授業情報、平均評価、口コミ一覧が表示される
4. IF 必須項目が未入力の場合 THEN バリデーションエラーが表示される
5. WHEN 授業情報を編集する THEN 変更履歴が記録される

### Requirement 3: 口コミ・評価システム
**User Story:** 履修経験のある学生として、後輩のために授業の詳細なレビューを投稿したい

#### Acceptance Criteria
1. WHEN 認証済みユーザーが口コミを投稿する THEN 総合評価（5段階）、難易度（5段階）、課題量（5段階）、詳細コメントが保存される
2. WHEN 口コミを投稿する THEN 投稿者の学年・学部が匿名化されて表示される
3. WHEN 自分の口コミを編集する THEN 編集履歴が記録され、24時間以内であれば編集可能
4. IF 不適切なコンテンツが検出された場合 THEN 管理者による承認が必要になる
5. WHEN 口コミに「参考になった」投票をする THEN 投票数がカウントされ、人気順ソートに反映される

### Requirement 4: 検索・フィルタリング機能
**User Story:** 大学生として、履修を検討している授業を効率的に見つけたい

#### Acceptance Criteria
1. WHEN 授業名または教員名で検索する THEN 部分一致で該当する授業が表示される
2. WHEN 学部・学科でフィルタリングする THEN 該当する授業のみが表示される
3. WHEN 評価・難易度でソートする THEN 指定した条件で並び替えられた結果が表示される
4. WHEN 単位数で絞り込む THEN 指定した単位数の授業のみが表示される
5. IF 検索結果が0件の場合 THEN 「該当する授業が見つかりません」メッセージが表示される

### Requirement 5: プレミアム機能（過去問アクセス）
**User Story:** より詳細な試験情報を得たい学生として、プレミアム機能を利用したい

#### Acceptance Criteria
1. WHEN 無料ユーザーが過去問セクションにアクセスする THEN プレミアム登録への案内が表示される
2. WHEN プレミアム登録を行う THEN Stripe決済システムで月額料金が処理される
3. WHEN プレミアムユーザーが過去問を閲覧する THEN PDF形式の過去問がダウンロード可能になる
4. IF 決済に失敗した場合 THEN エラーメッセージと再試行オプションが表示される
5. WHEN プレミアム登録を解約する THEN 次回請求日まではアクセス権が維持される

### Requirement 6: 管理者機能
**User Story:** システム管理者として、プラットフォームの健全性を維持したい

#### Acceptance Criteria
1. WHEN 管理者がダッシュボードにアクセスする THEN 総ユーザー数、投稿数、売上統計が表示される
2. WHEN 不適切な口コミを報告された場合 THEN 管理者が承認・削除・編集を実行できる
3. WHEN 新しい授業を一括登録する THEN CSVアップロード機能で複数授業を登録できる
4. IF ユーザーが利用規約に違反した場合 THEN アカウント停止処理が実行される
5. WHEN システム通知を送信する THEN 全ユーザーまたは特定グループに通知が配信される

### Requirement 7: UI/UX要件
**User Story:** ユーザーとして、直感的で使いやすいインターフェースでサービスを利用したい

#### Acceptance Criteria
1. WHEN モバイルデバイスでアクセスする THEN レスポンシブデザインで最適表示される
2. WHEN ページ読み込みを行う THEN 3秒以内にコンテンツが表示される
3. WHEN ShadcnUIコンポーネントを使用する THEN 一貫したデザインシステムが適用される
4. IF アクセシビリティ要件を満たす THEN スクリーンリーダー対応とキーボードナビゲーションが可能
5. WHEN ダークモード切り替えを行う THEN ユーザー設定が保存され、次回アクセス時に適用される

### Requirement 8: 技術要件とパフォーマンス
**User Story:** システム利用者として、安定して高速に動作するサービスを利用したい

#### Acceptance Criteria
1. WHEN Next.js 15 App Routerを使用する THEN SEO最適化とサーバーサイドレンダリングが適用される
2. WHEN データベースアクセスを行う THEN Supabaseとの接続プールが効率的に管理される
3. WHEN 画像アップロードを行う THEN 自動リサイズとWebP変換が実行される
4. IF 同時アクセス数が1000を超える場合 THEN システムが安定動作を維持する
5. WHEN セキュリティ監査を実施する THEN OWASP Top 10の脆弱性対策が実装されている

### Requirement 9: データ管理と拡張性
**User Story:** 将来的に複数大学に展開する際に、スムーズに拡張できるシステムにしたい

#### Acceptance Criteria
1. WHEN 新しい大学を追加する THEN 既存データに影響なく大学別データが管理される
2. WHEN データエクスポートを実行する THEN JSON/CSV形式でデータが出力される
3. WHEN バックアップを作成する THEN 日次自動バックアップがSupabaseで実行される
4. IF 大学固有の設定が必要な場合 THEN 大学別設定が柔軟に対応できる
5. WHEN API連携を行う THEN 将来的な外部システム連携に対応した設計になっている

### Requirement 10: 分析とレポート機能
**User Story:** 運営者として、サービスの利用状況を把握し、改善につなげたい

#### Acceptance Criteria
1. WHEN 利用統計を確認する THEN ユーザー数、投稿数、ページビューがグラフ表示される
2. WHEN 人気授業ランキングを表示する THEN 口コミ数と評価に基づいたランキングが生成される
3. WHEN ユーザー行動を分析する THEN 検索キーワードと閲覧パターンが記録される
4. IF 異常なアクセスパターンを検出した場合 THEN アラートが管理者に送信される
5. WHEN 月次レポートを生成する THEN 自動でPDF形式のレポートが作成される