# Implementation Plan

## 進捗状況
- Created: 2025-07-20T16:41:00Z
- Status: Ready for implementation
- Total tasks: 31
- Completed: 0
- Remaining: 31

## 実装タスク一覧

- [ ] **1. プロジェクトセットアップとコア構造**
  - [ ] 1.1 Next.js 15プロジェクト初期化とディレクトリ構造作成
    - Next.js 15 App Routerプロジェクトの作成
    - TypeScript設定とESLint/Prettier設定
    - app/, components/, lib/, types/, hooks/ディレクトリ構造の構築
    - _要件: 技術要件8.1_
  
  - [ ] 1.2 依存関係とツールチェーンのセットアップ
    - package.json依存関係設定（Supabase、Stripe、ShadcnUI、TailwindCSS）
    - 環境変数設定（.env.example作成）
    - 開発・テスト・ビルドスクリプト設定
    - _要件: 技術要件8.1_
  
  - [ ] 1.3 TailwindCSSとShadcnUIの統合
    - TailwindCSS設定とテーマカスタマイズ
    - ShadcnUIコンポーネントライブラリの初期化
    - components/ui/基盤コンポーネントの設定
    - _要件: UI/UX要件7.3_

- [ ] **2. データベース設計と実装**
  - [ ] 2.1 Supabaseプロジェクトセットアップ
    - Supabaseプロジェクト作成と接続設定
    - lib/supabase/client.tsとserver.tsの実装
    - 環境変数とAPI key設定
    - _要件: 技術要件8.2_
  
  - [ ] 2.2 データベーススキーマ作成
    - universitiesテーブル設計と作成
    - usersテーブル（profiles）設計と作成
    - coursesテーブル設計と作成
    - reviewsテーブル設計と作成
    - past_examsテーブル設計と作成
    - _要件: 授業情報管理2.1, レビューシステム3.1_
  
  - [ ] 2.3 Row Level Security (RLS) ポリシー設定
    - ユーザー認証ベースのRLSポリシー実装
    - 大学別データアクセス制御
    - 管理者権限とプレミアムユーザー権限の設定
    - _要件: ユーザー認証1.3, 管理者機能6.1_
  
  - [ ] 2.4 データベーストリガーと関数
    - 授業評価集計の自動更新トリガー
    - 口コミ投稿時の匿名化処理関数
    - プレミアム機能のアクセス制御関数
    - _要件: レビューシステム3.1, プレミアム機能5.1_

- [ ] **3. 認証システム実装**
  - [ ] 3.1 Supabase Auth統合
    - lib/auth/supabase-auth.tsの実装
    - 認証状態管理とコンテキスト作成
    - 認証ミドルウェア（middleware.ts）の実装
    - _要件: ユーザー認証1.1, 1.2_
  
  - [ ] 3.2 認証関連UI コンポーネント
    - components/auth/LoginForm.tsxの実装
    - components/auth/RegisterForm.tsxの実装
    - components/auth/PasswordResetForm.tsxの実装
    - _要件: ユーザー認証1.1, 1.5_
  
  - [ ] 3.3 認証ページの実装
    - app/(auth)/login/page.tsxの実装
    - app/(auth)/register/page.tsxの実装
    - app/(auth)/reset-password/page.tsxの実装
    - 認証フロー全体のテスト実装
    - _要件: ユーザー認証1.2, 1.4_
  
  - [ ] 3.4 プロフィール管理機能
    - ユーザープロフィール編集コンポーネント
    - 学年・学部情報設定機能
    - アバターアップロード機能（Supabase Storage）
    - _要件: ユーザー認証1.3_

- [ ] **4. 授業管理システム実装**
  - [ ] 4.1 授業データモデルとAPIエンドポイント
    - types/course.tsでCourse型定義
    - app/api/courses/route.ts（一覧・作成）実装
    - app/api/courses/[id]/route.ts（詳細・更新・削除）実装
    - _要件: 授業情報管理2.1, 2.5_
  
  - [ ] 4.2 授業一覧表示機能
    - components/course/CourseCard.tsxの実装
    - components/course/CourseList.tsxの実装
    - ページネーション機能の実装
    - _要件: 授業情報管理2.2_
  
  - [ ] 4.3 授業詳細ページ
    - app/(dashboard)/courses/[id]/page.tsxの実装
    - 授業情報、平均評価、口コミ一覧の表示
    - 評価統計の可視化コンポーネント
    - _要件: 授業情報管理2.3_
  
  - [ ] 4.4 検索・フィルタリング機能
    - components/search/SearchBar.tsxの実装
    - components/filters/CourseFilters.tsxの実装
    - 部分一致検索とソート機能の実装
    - _要件: 検索・フィルタリング4.1, 4.2, 4.3, 4.4_

- [ ] **5. 口コミ・レビューシステム実装**
  - [ ] 5.1 レビューデータモデルとAPI
    - types/review.tsでReview型定義
    - app/api/reviews/route.ts（一覧・作成）実装
    - app/api/reviews/[id]/route.ts（更新・削除）実装
    - app/api/reviews/[id]/helpful/route.ts（投票機能）実装
    - _要件: レビューシステム3.1, 3.5_
  
  - [ ] 5.2 レビュー投稿フォーム
    - components/review/ReviewForm.tsxの実装
    - 5段階評価コンポーネントの実装
    - バリデーションとエラーハンドリング
    - _要件: レビューシステム3.1_
  
  - [ ] 5.3 レビュー表示コンポーネント
    - components/review/ReviewCard.tsxの実装
    - components/review/ReviewList.tsxの実装
    - 匿名化表示と「参考になった」投票機能
    - _要件: レビューシステム3.2, 3.5_
  
  - [ ] 5.4 レビュー編集と管理機能
    - 24時間以内編集制限の実装
    - 不適切コンテンツ報告機能
    - 編集履歴の記録機能
    - _要件: レビューシステム3.3, 3.4_

- [ ] **6. 管理者ダッシュボード実装**
  - [ ] 6.1 管理者認証と権限管理
    - 管理者ロールベースアクセス制御
    - app/admin/middleware.tsの実装
    - 管理者専用ルートガード
    - _要件: 管理者機能6.4_
  
  - [ ] 6.2 授業一括管理機能
    - app/admin/courses/page.tsxの実装
    - CSVアップロード機能（components/admin/CSVUpload.tsx）
    - 授業情報の一括編集・削除機能
    - _要件: 管理者機能6.3_
  
  - [ ] 6.3 コンテンツモデレーション
    - 不適切レビューの管理画面
    - 承認・削除・編集機能の実装
    - ユーザーアカウント停止機能
    - _要件: 管理者機能6.2, 6.4_
  
  - [ ] 6.4 分析ダッシュボード
    - app/admin/analytics/page.tsxの実装
    - ユーザー数・投稿数・売上統計の表示
    - グラフとチャート表示（Chart.js/Recharts）
    - _要件: 管理者機能6.1, 分析・レポート10.1_

- [ ] **7. プレミアム機能とStripe決済**
  - [ ] 7.1 Stripe統合セットアップ
    - lib/stripe/client.tsとserver.tsの実装
    - Stripe webhook処理（app/api/stripe/webhooks/route.ts）
    - 決済プランとプライス設定
    - _要件: プレミアム機能5.2_
  
  - [ ] 7.2 サブスクリプション管理
    - プレミアム登録フローの実装
    - サブスクリプション状態管理
    - 決済失敗・解約処理の実装
    - _要件: プレミアム機能5.2, 5.4, 5.5_
  
  - [ ] 7.3 過去問アップロード・管理
    - 過去問ファイルアップロード機能（Supabase Storage）
    - app/api/premium/past-exams/route.tsの実装
    - PDF表示・ダウンロード機能
    - _要件: プレミアム機能5.3_
  
  - [ ] 7.4 プレミアムアクセス制御
    - プレミアムユーザー判定ミドルウェア
    - 無料ユーザー向けプロモーション表示
    - アクセス権限の動的制御
    - _要件: プレミアム機能5.1_

- [ ] **8. UI/UXとレスポンシブデザイン**
  - [ ] 8.1 共通レイアウトコンポーネント
    - components/layout/Header.tsxの実装
    - components/layout/Navigation.tsxの実装
    - components/layout/Footer.tsxの実装
    - _要件: UI/UX要件7.1_
  
  - [ ] 8.2 レスポンシブデザイン対応
    - モバイルファーストのTailwindCSS設計
    - タブレット・デスクトップ向け最適化
    - タッチインターフェース対応
    - _要件: UI/UX要件7.1_
  
  - [ ] 8.3 アクセシビリティ対応
    - ARIA属性とスクリーンリーダー対応
    - キーボードナビゲーション実装
    - カラーコントラスト最適化
    - _要件: UI/UX要件7.4_
  
  - [ ] 8.4 ダークモードとテーマ切替
    - テーマコンテキストとプロバイダー実装
    - ダークモード切替コンポーネント
    - ユーザー設定の永続化
    - _要件: UI/UX要件7.5_

- [ ] **9. パフォーマンス最適化**
  - [ ] 9.1 Next.js最適化実装
    - 静的生成とISRの設定
    - 画像最適化（next/image）の実装
    - バンドルサイズ最適化
    - _要件: 技術要件8.1, 8.3_
  
  - [ ] 9.2 データベースクエリ最適化
    - インデックス作成と最適化
    - N+1クエリ問題の解決
    - ページネーションの効率化
    - _要件: 技術要件8.2, 8.4_
  
  - [ ] 9.3 キャッシング戦略実装
    - React QueryまたはSWRの統合
    - APIレスポンスキャッシング
    - 静的アセットキャッシング
    - _要件: 技術要件8.2_

- [ ] **10. セキュリティ実装**
  - [ ] 10.1 入力バリデーション
    - Zodスキーマ定義（lib/validations/）
    - サーバーサイドバリデーション実装
    - XSS・SQLインジェクション対策
    - _要件: 技術要件8.5_
  
  - [ ] 10.2 レート制限とセキュリティヘッダー
    - API レート制限の実装
    - セキュリティヘッダーの設定
    - CSRF保護の実装
    - _要件: 技術要件8.5_

- [ ] **11. 分析とモニタリング**
  - [ ] 11.1 利用統計収集
    - ページビュー・ユーザー行動トラッキング
    - 検索キーワード分析
    - A/Bテスト基盤の実装
    - _要件: 分析・レポート10.3_
  
  - [ ] 11.2 月次レポート機能
    - 月次統計データの集計処理
    - PDFレポート生成機能
    - 自動配信システムの実装
    - _要件: 分析・レポート10.5_

- [ ] **12. テスト実装**
  - [ ] 12.1 単体テスト
    - Jestとテスティングライブラリ設定
    - コンポーネント単体テスト実装
    - ユーティリティ関数テスト
    - _要件: 全要件のテストカバレッジ_
  
  - [ ] 12.2 統合テスト
    - API エンドポイント統合テスト
    - データベース操作テスト
    - 認証フローテスト
    - _要件: 全要件のテストカバレッジ_
  
  - [ ] 12.3 E2Eテスト
    - Playwright設定とテストシナリオ作成
    - 主要ユーザーフローのE2Eテスト
    - 決済フローE2Eテスト
    - _要件: 全要件のテストカバレッジ_

- [ ] **13. デプロイメントと運用**
  - [ ] 13.1 本番環境設定
    - Vercelデプロイ設定とCI/CD
    - 環境変数と秘密情報管理
    - ドメイン設定とSSL証明書
    - _要件: 技術要件8.1_
  
  - [ ] 13.2 監視とエラートラッキング
    - Sentryエラートラッキング設定
    - ログ収集とモニタリング
    - アラート設定とインシデント対応
    - _要件: 分析・レポート10.4_
  
  - [ ] 13.3 バックアップと災害復旧
    - Supabaseの自動バックアップ設定
    - データ復旧手順の文書化
    - 災害復旧計画の策定
    - _要件: データ管理9.3_

## 依存関係マップ
- **Phase 1**: 1.x → 2.x → 3.x （基盤構築）
- **Phase 2**: 4.x → 5.x （コア機能）
- **Phase 3**: 6.x → 7.x → 8.x （高度な機能・UI）
- **Phase 4**: 9.x → 10.x → 11.x （最適化・分析）
- **Phase 5**: 12.x → 13.x （テスト・デプロイ）

## 技術的注意事項
- **Next.js 15**: srcディレクトリは使用せず、app/ディレクトリ直下に配置
- **TypeScript**: 厳密な型定義とnull安全性を確保
- **Supabase**: Row Level Security (RLS) を活用したセキュリティ設計
- **Stripe**: webhookの署名検証を必須実装
- **TailwindCSS**: ユーティリティファーストの設計原則に従う
- **テスト**: 各機能の実装と並行してテストを作成