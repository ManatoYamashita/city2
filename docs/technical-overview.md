# 技術概要

## システム全体の構成

### 基本的な仕組み

City2は現代的なWebアプリケーションの技術を使って作られています。これは図書館のシステムに例えると分かりやすいでしょう：

**図書館との比較**
- **受付（フロントエンド）**: ユーザーが実際に操作する画面
- **書庫（データベース）**: 授業情報やレビューを保存する場所
- **司書（バックエンド）**: ユーザーの要求を処理し、適切な情報を取り出す役割
- **セキュリティ（認証システム）**: 図書館の利用者カードのような身分確認

### 使用している主要技術

#### フロントエンド（ユーザーが見る部分）

**Next.js 15**
- ウェブサイトの画面を作るための最新の技術
- 高速で使いやすいユーザー体験を提供
- スマートフォンやタブレットでも快適に動作

**React**
- 画面の部品（ボタン、フォームなど）を効率的に管理
- ユーザーの操作に素早く反応
- 現代のWebサイトで広く使われている標準技術

**TailwindCSS + ShadcnUI**
- サイトの見た目（デザイン）を統一
- 美しく使いやすいインターフェース
- アクセシビリティ（使いやすさ）を重視した設計

#### バックエンド（システムの裏側）

**Supabase**
- データを安全に保存・管理するクラウドサービス
- 銀行レベルのセキュリティで情報を保護
- 自動バックアップでデータ損失を防止

**PostgreSQL**
- 信頼性の高いデータベース技術
- 大量のデータを効率的に処理
- 企業で広く採用されている実績ある技術

#### 決済システム

**Stripe**
- 国際的に信頼されている決済処理サービス
- クレジットカード情報を安全に処理
- PCI DSS準拠による最高レベルのセキュリティ

## データの保存と管理

### データベース設計

**テーブル構造（データの整理方法）**

図書館の整理システムと同じように、情報を種類別に分けて保存しています：

**大学情報**
- 大学名、所在地、ウェブサイト
- 学部・学科の情報

**ユーザー情報**
- メールアドレス（ログイン用）
- パスワード（暗号化して保存）
- 学年・学部（統計用、匿名化）

**授業情報**
- 科目名、教員名、単位数
- 開講時期、学部・学科
- 統計データ（平均評価など）

**レビュー情報**
- 評価点数（5段階）
- コメント内容
- 投稿日時
- 匿名化された投稿者情報

### データの関連性

**リレーショナル設計**
- 各データは適切に関連付けられています
- 例：レビューは必ず特定の授業に紐づく
- データの整合性を自動的に保持

### バックアップとセキュリティ

**自動バックアップ**
- 毎日自動的にデータをバックアップ
- 複数の場所に保存してリスク分散
- 障害時は迅速にデータを復旧

**暗号化**
- 保存データは暗号化（解読不能な形式に変換）
- 通信は全てHTTPS（暗号化通信）
- パスワードは不可逆暗号化で保存

## システムの安全性

### ユーザー認証

**ログインシステム**
- メールアドレスとパスワードによる認証
- セッション管理で安全なログイン状態を維持
- 不正アクセスの検知と防止

**権限管理**
- 一般ユーザー、プレミアムユーザー、管理者の区分
- 各ユーザーは自分の権限範囲内でのみ操作可能
- 管理者機能への不正アクセスを完全防止

### Row Level Security（RLS）

**データアクセス制御**
図書館で例えると、利用者カードがないと本を借りられないのと同じように：
- ユーザーは自分のデータにのみアクセス可能
- 他人のレビューを勝手に編集・削除不可
- 管理者のみが全体データを管理

### 匿名性の保護

**プライバシー保護設計**
- 投稿者の個人情報は完全に分離
- レビューには学年・学部の大分類のみ表示
- IPアドレスや端末情報は記録・表示しない

## パフォーマンス最適化

### 高速化の仕組み

**サーバーサイドレンダリング**
- ページの内容をサーバー側で事前準備
- ユーザーには完成した画面を高速配信
- 検索エンジンでも正しく認識される

**データベース最適化**
- よく使われる検索条件にインデックス設定
- 複雑な集計処理の効率化
- 大量データでも高速な検索を実現

**キャッシュシステム**
- よく見られるデータを一時保存
- 同じ情報への再アクセスを高速化
- サーバー負荷の軽減

### 拡張性

**スケーラブル設計**
- ユーザー数増加に対応可能な設計
- クラウドサービスによる自動拡張
- 複数大学展開を見据えたマルチテナント構造

## セキュリティ対策

### 一般的な攻撃への対策

**SQLインジェクション対策**
- データベースへの不正な命令実行を防止
- 入力値の適切な検証とエスケープ処理
- ORM（データベース操作ライブラリ）による安全な処理

**XSS（クロスサイトスクリプティング）対策**
- 悪意のあるスクリプトの実行を防止
- ユーザー入力の適切なサニタイゼーション
- CSP（Content Security Policy）による制御

**CSRF（クロスサイトリクエストフォージェリ）対策**
- 偽造されたリクエストからの保護
- トークンベースの認証システム
- SameSite Cookieによる追加保護

### 監視とログ

**アクセス監視**
- 異常なアクセスパターンを自動検知
- 不正ログイン試行の監視
- DDoS攻撃などへの自動対応

**操作ログ**
- 全ての重要な操作を記録
- 管理者の操作も漏れなく記録
- インシデント発生時の原因調査に活用

## 外部サービス連携

### 信頼できるパートナー

**Supabase（データベース・認証）**
- Y Combinator出身の信頼できる企業
- PostgreSQLベースの高性能データベース
- 企業レベルのセキュリティと可用性

**Stripe（決済処理）**
- 世界中で利用されている決済プラットフォーム
- PCI DSS Level 1認証取得
- 99.99%の稼働率実績

**Vercel（ホスティング）**
- Next.jsの開発元による最適化されたホスティング
- 世界中のCDN（配信ネットワーク）活用
- 自動スケーリングによる高可用性

### API設計

**RESTful API**
- 標準的なWeb API設計パターン
- 予測可能で理解しやすいインターフェース
- 将来的な機能拡張に対応

**認証・認可**
- JWTトークンによる安全な認証
- API利用制限による不正使用防止
- レート制限による過負荷防止

## 開発・運用プロセス

### 品質管理

**コードレビュー**
- 全ての変更は複数人でチェック
- セキュリティ脆弱性の事前発見
- 品質基準の維持

**自動テスト**
- 機能の正常動作を自動確認
- 新機能追加時の既存機能への影響チェック
- 継続的な品質保証

### デプロイメント

**継続的デプロイ**
- コード変更の自動テスト
- 問題なければ自動的に本番環境に反映
- ダウンタイムなしでの更新

**ロールバック機能**
- 問題発生時の迅速な前バージョンへの復元
- データ損失なしでの緊急対応
- 最小限の影響でのサービス継続

## 今後の技術的な発展

### 拡張予定の技術

**AI・機械学習の活用**
- レビューの品質評価自動化
- 不適切コンテンツの自動検出
- 個人に最適化された授業推薦

**モバイルアプリ化**
- iOS/Androidネイティブアプリ
- プッシュ通知による情報配信
- オフライン機能の提供

**データ分析の高度化**
- より詳細な統計データの提供
- 予測分析による履修支援
- 学習成果との相関分析

### インフラの発展

**マイクロサービス化**
- 機能ごとの独立したサービス分割
- より柔軟で保守しやすいシステム
- 部分的な更新・拡張の容易化

**国際展開対応**
- 多言語対応システム
- 各国の法規制への対応
- 地域別のデータセンター活用

## 技術選択の理由

### なぜこの技術スタックを選んだか

**開発効率**
- モダンなフレームワークによる高速開発
- 豊富なコミュニティサポート
- 学習リソースの充実

**保守性**
- 将来の機能追加・変更に対応しやすい設計
- 標準的な技術による属人化の回避
- 長期的な技術サポート

**スケーラビリティ**
- ユーザー数増加への対応
- 機能拡張の容易さ
- 運用コストの最適化

**セキュリティ**
- 実績のあるセキュリティ機能
- 定期的なセキュリティアップデート
- 企業レベルの信頼性

この技術選択により、安全で高性能、かつ将来の成長に対応できるシステムを構築しています。